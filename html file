<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Bloom</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>

<h1>Bloom</h1>
<h2>Your daily motivator</h2>

<label for="mood">How are you feeling today?</label>
<select id="mood">
    <option value="1">Happy</option>
    <option value="2">Tired</option>
    <option value="3">Anxious</option>
    <option value="4">Focused</option>
    <option value="5">Angry</option>
    <option value="6">Sick</option>
</select>

<label for="availableHours">How many hours are you available today?</label>
<input type="number" id="availableHours" placeholder="e.g., 6" />

<h2>Enter 5 Tasks</h2>

<div id="taskInputs"></div>

<button onclick="submitData()">Generate Schedule</button>

<div id="result"></div>

<script>
    const taskInputsDiv = document.getElementById('taskInputs');
    const tasks = [];

    function addTaskInput() {
        if (tasks.length >= 5) return;

        const index = tasks.length;
        const container = document.createElement('div');

        container.innerHTML = `
                <label>Task ${index + 1} Title:</label>
                <input type="text" id="title-${index}" placeholder="e.g., Study math" />

                <label>Priority:</label>
                <select id="priority-${index}">
                    <option value="1">1 - Highest</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 - Lowest</option>
                </select>

                <label>Deadline:</label>
                <select id="deadline-${index}">
                    <option value="08:00">8:00 AM</option>
                    <option value="09:00">9:00 AM</option>
                    <option value="10:00">10:00 AM</option>
                    <option value="11:00">11:00 AM</option>
                    <option value="12:00">12:00 PM</option>
                    <option value="13:00">1:00 PM</option>
                    <option value="14:00">2:00 PM</option>
                    <option value="15:00">3:00 PM</option>
                    <option value="16:00">4:00 PM</option>
                    <option value="17:00">5:00 PM</option>
                    <option value="18:00">6:00 PM</option>
                </select>
                <hr/>
            `;

        taskInputsDiv.appendChild(container);
        tasks.push(index);
    }

    async function submitData() {
        const mood = parseInt(document.getElementById("mood").value);
        const availableHours = parseInt(document.getElementById("availableHours").value);

        if (!mood || !availableHours || tasks.length !== 5) {
            alert("Please complete all fields and add 5 tasks.");
            return;
        }

        const taskData = tasks.map(index => ({
            title: document.getElementById(`title-${index}`).value,
            priority: parseInt(document.getElementById(`priority-${index}`).value),
            deadline: document.getElementById(`deadline-${index}`).value
        }));

        const requestBody = {
            mood,
            availableHours,
            tasks: taskData
        };

        try {
            const response = await fetch('http://localhost:8080/generate-schedule', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                throw new Error("Failed to get schedule");
            }

            const result = await response.json();
            displayResult(result);
        } catch (error) {
            alert("Error: " + error.message);
        }
    }

    function displayResult(schedule) {
        const div = document.getElementById('result');
        div.innerHTML = `
                <h2>Your Schedule</h2>
                <strong>Tasks:</strong>
                <ul>${schedule.tasks.map(t => `<li>${t.title} (Priority: ${t.priority}, Deadline: ${t.deadline})</li>`).join('')}</ul>

                <strong>Breaks:</strong>
                <ul>${schedule.breaks.map(b => `<li>${b}</li>`).join('')}</ul>

                <strong>Tip:</strong>
                <p>${schedule.tip}</p>
            `;
    }

    // Automatically add 5 task input fields
    for (let i = 0; i < 5; i++) {
        addTaskInput();
    }
</script>

</body>
</html>
